<!--start content-->
<section id="" class="fgrid_12 clearfix">
  <div id="main" class="full_width alpha pad welcomeStep">

<script language="javascript">

var changed = false;
var formData = {};
$(function() {

  $(".features a").each(function() {
<<<<<<< HEAD
    if (!this.addEventListener)
			this.attachEvent('click', function() { changed = true}, false);
		else
		  this.addEventListener('click', function() { changed = true}, false);

  });

  $("#new_category_id a").each(function() {
    if (!this.addEventListener)
			this.attachEvent('click', function() { changed = true}, false);
		else
		  this.addEventListener('click', function() { changed = true}, false);

=======
    if (!this.addEventListener) {
      this.addEventListener('click', function() { changed = true}, false);
    }else{
      this.addEventListener('click', function() { changed = true}, false);
    }
  });

  $("#new_category_id a").each(function() {
    if (!this.addEventListener){
      this.attachEvent('click', function() { changed = true}, false);
		}else{
      this.addEventListener('click', function() { changed = true}, false);
    }
			
>>>>>>> 552fb8504cfe6060065c49840d42a8cdf2182145
  });

  $(".subcatContainer a").each(function() {
    if (!this.addEventListener)
<<<<<<< HEAD
			eventHandler = this.attachEvent('click', function() { changed = true}, false);
		else
		  eventHandler = this.addEventListener('click', function() { changed = true}, false);

=======
		this.attachEvent('click', function() { changed = true}, false);
		else
		this.addEventListener('click', function() { changed = true}, false);
			
>>>>>>> 552fb8504cfe6060065c49840d42a8cdf2182145
  });

  $('#categorypage').each(function() {
    var action = "categorypage";
    formData[action] = {};
		
    // Only checking text fields for now...
    $('input[type=text]', this).each(function() {
      formData[action][this.name] = this.value;
<<<<<<< HEAD
      if (!this.addEventListener){
			this.attachEvent(
        'change',
        function() {check_modified(this.name, this.value);},
        false
      );
		}else{
		  this.addEventListener(
        'change',
        function() {check_modified(this.name, this.value);},
        false
      );
		}

=======
      if (!this.addEventListener)
        this.attachEvent('click', function() { check_modified(this.name, this.value);}, false);
		else
		this.addEventListener('click', function() { check_modified(this.name, this.value);}, false);
			
>>>>>>> 552fb8504cfe6060065c49840d42a8cdf2182145
    });
  });
});

function set_changed()
{
  changed = true;
}

function check_modified(name, value)
{
  if (formData["categorypage"][name] != value)
    changed = true;
}

window.onbeforeunload = function() {
  //return "Leaving this page will reset the wizard";
  if (changed){
    return "Leaving this page will cause newly entered data to be lost as it has yet to be saved."
  }
};


$(function() {
  function validateFunc(){
    $("#categorypage").validate({
      submitHandler: function(form) {
      changed = false;
        // $('.grayLoader').show();
        form.submit();
      },messages:{
				categoryType:{
					required: 'Please select main category for your business.'
				},
				subCategoryType:{
					required:'Please select sub-category for your business.'	
				}
		}
    });
  }
	$("#tagsVal").keyup(function(){
    $("#loader_tags").show();  
    tags = $("#tagsVal").val();
    cat = $("#new_category_id a.selected").attr("data-id");
    subcat = $(".subcatContainer a.selected").attr("data-id");

    $.ajax({
      type: "GET",
      cache: false,
      url: "/business/tag_suggestions?tag=" + tags + "&cat=" + cat + "&scat=" + subcat + "&type=place",
      data: $(this).serializeArray(),
      success: function(data) {
        if(data!='')
          $('#tagContainer').show();
        else
          $('#tagContainer').hide();
       	$("#tagClick").empty().append(data);
        $("#loader_tags").hide();
      }
    });
  });
  validateFunc();
  $('.catListStyle a').click(function(e) {validateFunc();});	
});
$(document).ready(function(){
 $("#save_button").click(function(){$("#categorypage").submit(); });
  $("#galleryPop").click(function(){
    $("gallery_id").val('');
    $("#galform #cname").val('');
    $("#galform #cdescription").val('');
    $('#imgGallery').css("background",'url(../images/building.png)').css("background-size","100% 100%");
  });
  $("#galleryPop").fancybox({
  	'titlePosition'		: 'outside',
  	'transitionIn'		: 'none',
  	'transitionOut'		: 'none'
  });
  <% unless @place.nil? %>
    $('#imgProfile').css("background","url('<%= TempImage.get_profile_image_url(current_user, 'profile') %>')");
  <% end %>
});
</script>

      <h2 class="bold">SELECT YOUR BUSINESS CATEGORY & FEATURES</h2>
       
      	<div class="full_width container_12 no_margin">


<%= form_tag '/welcome/category_page',  :id => "categorypage", :method => :post do -%>
  <%= hidden_field_tag :selected_category_id, (@place.category_id rescue '')%>
  <div class="box full_width pad createPage no_margin">
    <div class="container_12 full_width  inputs pad_top20 pad_bot inlineB catListStyle">
      
      <div class="grid_3 align_right">
        <label class="bold">Category</label>
        <div class="catDetails">Select a category<br />
          related to your business</div>
          <input type="hidden" name="categoryType" id="category_input" value="" class="required"/>
          <label for="category_input" name="category_input_label" id="category_input_label" generated="false" class="error" ></label>
        </div>
        <div class="grid_9" id="new_category_id">
          <% Category.parent_categories.each do |cat|%>
            <a data-id="<%= cat.id %>" class="cursor cat" id="category_<%= cat.id %>" title="<%= cat.name %>"><div class="grid_6"><%= truncate(cat.name, :length => 30, :omission => "...") %></div></a>
          <% end %>
          <div class="grid_6 selectCategory">change Category</div>
        </div>
       <div class="clearfix pad_bot"></div>
      <div class="grid_3">&nbsp;</div>
      <div id="catHelpInfo" class="grid_9 no_margin fright bgGray radius5">
      	<div class="pad15 catHelpInfo">
        <ul class="listNone">
        <li class="bold">Can’t find a suitable Category & Subcategory combination for your business? Please follow these steps:</li>
        
        <li class="pad_top"><b>1.</b> Select a <b>Category</b> that best relates to your business type.</li>
        
        <li class="pad_top"><b>2.</b> In the <b>Subcategory</b> list, select ‘Others’.</li>
        
        <li class="pad_top"><b>3.</b> Proceed to <b>‘Tags’</b>. You then input keywords that are related to your business. Click on the ‘example’ link below ‘Tags’ to get a better understanding of what tags are.</li>
        
        <li class="pad_top"><b>NOTE</b>: Not to worry, doing this will not in any way impact the search-ability & search ranking of your business within ZIGZEG.</li>
				</ul>
        </div>
      </div>
      </div>

      <!-- div for subcategory -->
      <div id="sub_category_div"> 
      </div>
<<<<<<< HEAD
      <div id="tags_div" class="dispNone full_width">
        <div class="clearfix"></div>
        <div class="full_width borderBot pad_top20"></div>
=======
      <div class="clearfix"></div>
      <div class="full_width borderBot pad_top20"></div>
        
      <div id="tags_div" class="dispNone full_width">
>>>>>>> 552fb8504cfe6060065c49840d42a8cdf2182145
        <div class="grid_3 align_right pad_top pad_bot">
         <label class="bold">Tags <span class="normal">(optional)</span></label><br />Keywords/Tags<br />related to your <br />business <br /><a class="blue example cursor"  name="helpInfo" href="#cmpDialog" title="click to view more information..." data-id="<h6>Tags</h6>A tag is a keyword or term assigned to a piece of information (such as an Internet bookmark, digital image, or computer file). This kind of data helps describe an item and allows it to be found again by browsing or searching. <br /><br />In Zigzeg, Tags allow you to associate your account with relevant keywords related to your business. Tags have a higher search priority ranking than normal words in our search engine and as such, allow your business better search ranking when used correctly.<br /><br />
<span class='white underline'>Example</span><br />
Let’s say you are in the coffee shop business. Keywords associated with your business may be words like <span class='ital'>coffee, coffee bean, cafe, shop, drink, beverage, latte, mocha, espresso, cappuccino</span> and so on. You can input these keywords into the Tags field.">view example</a>
        </div>
        <div class="grid_9 no_margin fright">
          <div class="grid_12 pad_top20 no_margin">
            <input type="text" class="radius5 fancyinput" id="tagsVal" name="place[tags]" value="<%= @place.tags rescue '' %>" autocomplete="off">
            <%=  show_loader("tags") %>
            <br/><label for="tagsVal" generated="false" class="error"></label>
          </div>
          <div id="tagContainer" class="dispNone">
            <div class="grid_12 ">
              <div class="grid_2 pad_top5 no_margin">Suggestions:</div>
              <div class="grid_10">
                <ul id="tagClick" class="tagList"></ul>
              </div>
            </div>
          </div>
          <div class="grid_12 pad_top5">Separate each tag using commas. Example: city, web, zigzeg</div>
                      <div class="grid_8 no_margin">
                        <ul id="tagClick" class="tagList">
                        </ul>
                      </div>
                      
                   </div>
      </div>
      <div id="all_sub" class="dispNone">
        <div class="full_width borderBot pad_top20"></div>
        <div class="container_12 inputs pad_top20 full_width inlineB catListStyle">
          <div class="grid_3 align_right">
            <label class="bold">Features <span class="normal">(optional)</span></label><br />
            Select features related<br />
            to your business<br />
            (multiple selections<br />
            allowed)
          </div>
  
          <div class="grid_9 no_margin fright">
            <div class="grid_12 no_margin pad_bot">Click a feature to select it, click again to deselect</div>
            <div class="grid_12 no_margin fullS bgGray radius5"><div class="pad10">1. Payment Options accepted by your business</div></div>
            <div class="grid_12 pad_top">
              <div class="grid_12 no_margin radius5 features">
                <% HighlightCategory.where("group_name='payment'").each do |cf|%>
                        <div align="center" class="grid_2">
                      <a class="features <%= @place.highlight_codes.include?(cf.code) ? "selected" : '' %>"><div></div>
                        <img src="/images/features/general/<%= cf.image%>">
                      <input type="checkbox" value="<%= cf.code %>" class="" name="features[]" <%= @place.highlight_codes.include?(cf.code) ? "checked" : '' %>>
                      <span class="clearfix">
                     <%= cf.name %></span></a>
                  </div>


                <% end %>
              </div>
            </div>
           	<div class="grid_12 borderBot"></div>
            <div class="clearfix pad_bot"></div>
            <div class="grid_12 no_margin fullS bgGray radius5"><div class="pad10">2. Parking Information at your business premise</div></div>
            <div class="grid_12 pad_top">
              <div class="grid_12 no_margin radius5 features">
                <% HighlightCategory.where("group_name='parking'").each do |cf|%>
                        <div align="center" class="grid_2">
                      <a class="features <%= @place.highlight_codes.include?(cf.code) ? "selected" : '' %>"><div></div>
                        <img src="/images/features/general/<%= cf.image%>">
                      <input type="checkbox" value="<%= cf.code %>" class="" name="features[]" <%= @place.highlight_codes.include?(cf.code) ? "checked" : '' %>>
                      <span class="clearfix">
                     <%= cf.name %></span></a>
                  </div>


                <% end %>
              </div>
            </div>
           	<div class="grid_12 borderBot"></div>
            <div class="clearfix pad_bot"></div>
            <div class="grid_12 no_margin fullS bgGray radius5"><div class="pad10">3. General Features offered by your business</div></div>
            <div class="grid_12 pad_top">
              <div class="grid_12 no_margin radius5 features">
                <% HighlightCategory.where("group_name='provides'").each do |cf|%>
                        <div align="center" class="grid_2">
                      <a class="features <%= @place.highlight_codes.include?(cf.code) ? "selected" : '' %>"><div></div>
                        <img src="/images/features/general/<%= cf.image%>">
                      <input type="checkbox" value="<%= cf.code %>" class="" name="features[]" <%= @place.highlight_codes.include?(cf.code) ? "checked" : '' %>>
                      <span class="clearfix">
                     <%= cf.name %></span></a>
                  </div>
                <% end %>
              </div>
            </div>
            
            
            <div id="category_features_div"></div>
            
            

          </div>
          
        </div>
      </div>

      
<!-- end container-->
      <div class="grid_12 border"></div>
      <div class="clearfix ">&nbsp;</div>
      <div class="container_12 pad_top20">
               <div class="grid_3 prefix_4">
               <a data-id="3" class="blue radius5 userButton white bold create nextStep cursor" id="save_button" >Save & Continue</a>
                </div>
               <div class="grid_2"><a href="/welcome/create_page" class="blue radius5 bgGray white bold backbtn userButton create" >Back</a>
                </div>

                <div class="clearfix ">&nbsp;</div>
              </div>
              
    </div>

              

<% end %>

        </div>


        
<script>

$(function() {
  <% unless @place.category.nil? %>
    $("#selected_category_id").val(<%= @place.category_id %>);
    <% unless @place.category.parent.nil? %>
      $('#category_<%= @place.category.parent.id %>').click();
      $('#sub_category_49').click();
    <% else %>
      $('#category_<%= @place.category_id %>').click();
    <% end %>
  <% end %>

    $("#save_gallery").click(function() {
      var ti_id = $("#gallery_id").val();
      if (ti_id == '')
        return false;

      $("#loader_gallery").show();
      $.ajax({
        type: "POST",
        cache: false,
        url: "/welcome/update_gallery?ti_id=" + ti_id,
        data: $("#galform").serializeArray(),
        success: function(data) {
          $(".galleryThumb").append(data).fadeIn();
          $("#loader_gallery").hide();
          $("#gallery_notifier").empty().show();
          $("#gallery_notifier").append("Saved").fadeOut(1000);
        }
      });
    });

    /*$("#place_category_id").change(function() {
      var cat_id = $("#place_category_id").val();
      $("#loader_category").show();
      $.ajax({
        type: "GET",
        cache: false,
        url: "/welcome/load_select_subcategories?cat_id=" + cat_id,
        data: $(this).serializeArray(),
        success: function(data) {
          $("#subcategory_id").empty();
          $("#subcategory_id").append(data).fadeIn();
          $("#loader_category").hide();
					
        }
      });*/
    });
</script>


</div>
</section>    
