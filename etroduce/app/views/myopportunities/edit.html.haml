%h2
  Edit opportunity:
%br

- form_for :opportunity, @opportunity, :url => myopportunity_path(:id => @opportunity.id), :html => {:method => :put, :id => "new_opportunity_form", :multipart => true } do |f|
  %div.field_line
    %div.field_label
      Title :
    %div.field_box
      = f.text_field :subject
  %div.clr
  %div.field_line
    %div.field_label
      Category :
    %div.field_box
      %ul{:class => "category"}
        - @categories.each do |cat|
          -istrue = @categories.index(cat) == 0 ? true : false
          %li{ :class => "selectable", :onclick => "toggle_price('#{cat.code}');" }
            = f.radio_button "category_id", cat.id
            = label_tag "category_id", cat.name, :for => "opportunity_category_id_#{cat.id}"
  %div.clr

  %div{:id => 'price_div'}
    %div.field_line
      %div.field_label
        Price (USD) :
      %div.field_box
        = f.text_field :price, :style => "width:100px;"
  %div.clr

  %div.field_line
    %div.field_label
      Description :
    %div.field_box
      = f.text_area :description, :style => "width:550px; height: 200px", :class => "mceEditor"
  %div.clr
  %div.field_line
    %div.field_label
      Location :
    %div.field_box
      = f.text_field :zipcode
  %div.clr

  %div.field_line
    %div.field_label
      Country :
    %div.field_box
      = select_tag :country, options_for_select(Etro::COUNTRIES, @opportunity.country)
  %div.clr

  %div.field_line
    %div.field_label
      Privacy :
    %div.field_box
      = select_tag :privacy, options_for_select(Etro::PRIVACY_LEVELS_OPTIONS, @opportunity.privacy)
  %div.clr
  
  %div.field_line
    %div.field_label
      Expires On :
    %div.field_box
      = f.text_field :expire_at, :placeholder => "yyyy-mm-dd"
  %div.clr

  %div.field_line
    %div.field_label
      Photos :
    %div.field_box{:style => "width: 420px;"}
      - @opportunity.assets.each do |asset|
        %div{:id => "opp_image_#{asset.id}", :onmouseover => "$('#delete_icon_#{asset.id}').show()", :onmouseout => "$('#delete_icon_#{asset.id}').hide()", :style => "clear:both; width: 200px; height: 65px; padding: 5px"}
          = image_tag asset.image.url(:thumb), :style => "float: left"
          %span{:id => "delete_icon_#{asset.id}", :style => "display: none; float: left; padding-left: 10px; margin-top: 20px"}
            = link_to "Remove", "javascript:;", :onclick => "removeImage('#{asset.id}')"
        %br
      - for i in 1..(4-@opportunity.assets.length)
        %div
          = file_field_tag "image[]"
        %br
  %div.clr

  %div.field_line
    %div.field_label
    %div.field_box
      = submit_tag "Update"
      = link_to "Cancel", myopportunities_path
  %br
:javascript

  $("#new_opportunity_form").bind('submit', function() {    
  });

  $(function() {
    $("#opportunity_expire_at").datepicker({ dateFormat: 'yy-mm-dd'});
  });
  
  function removeImage(asset_id){
    var ans = confirm("Are you sure you want to delete this photo?");
    if (!ans)
     return false

    $.fancybox.showActivity();
    $.ajax({
      type: 'POST',
      url: "/opportunities/remove_image/" + asset_id,
      cache : false,
      data: "id=" + asset_id,
      success: function(data) {
        $.fancybox.hideActivity();
        $("#opp_image_" + asset_id).fadeOut(function(){
          $(this).replaceWith("<br/><input id=\"image_\" name=\"image[]\" type=\"file\">");
        });
      }
      
    })
    
  }

  function toggle_price(code){
    if (code == 'dailydeals' || code == 'forsale'){
      $("#price_div").fadeIn('slow');
    }else{
      $("#price_div").fadeOut('slow', function() {
        $(this).hide();
      });
    }
  }
  
  toggle_price('#{@opportunity.category.code}')